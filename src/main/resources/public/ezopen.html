<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hikvision Show-EZOPEN播放协议</title>
    <link rel="stylesheet" href="fontawesome-free-5.13.0-web/css/all.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
    <script src="bootstrap/js/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="ezuikit.js"></script>
</head>
<body>
    <h2>EZOPEN LIVE</h2>
    <div id="playerWin" style="width: 1200px; height: 800px;"></div>
    <div class="btn-container">
        <button id="init">初始化</button>
        <button id="start">播放</button>
        <button id="stop">停止</button>
    </div>
    <div class="container">

        <div class="btn-toolbar btn-group-vertical" style="height: 180px;" role="toolbar">
            <div class="btn-group mr-1 col-md-2">
                <button type="button" class="btn btn-secondary ctrl" id="left-up" value="4" hint="左上">
                    <i class="fas fa-circle"></i>
                </button>
                <button type="button" class="btn btn-secondary ctrl" id="up" value="0" hint="上">
                    <i class="fas fa-arrow-up"></i>
                </button>
                <button type="button" class="btn btn-secondary ctrl" id="right-up" value="6" hint="右上">
                    <i class="fas fa-circle"></i>
                </button>
            </div>

            <div class="btn-group mr-1 col-md-2">
                <button type="button" class="btn btn-secondary ctrl" id="left" value="2" hint="左">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button type="button" class="btn btn-secondary" id="capture" value="capture" hint="抓拍">
                    <i class="fas fa-camera"></i>
                </button>
                <button type="button" class="btn btn-secondary ctrl" id="right" value="3" hint="右">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>


            <div class="btn-group mr-1 col-md-2">
                <button type="button" class="btn btn-secondary ctrl" id="left-down" value="5" hint="左下">
                    <i class="fas fa-circle"></i>
                </button>
                <button type="button" class="btn btn-secondary ctrl" id="down" value="1" hint="下">
                    <i class="fas fa-arrow-down"></i>
                </button>
                <button type="button" class="btn btn-secondary ctrl" id="right-down" value="7" hint="右下">
                    <i class="fas fa-circle"></i>
                </button>
            </div>
        </div>

    </div>
    <script>
        var appKey = "2f9ff1c7bd7f422c9c40ec1b80171277";
        var secret = "311c0891889036dfda1ceae59851fb51";
        var accessToken = "at.2ly6ayhtdou0txin8bempq856utsjr59-5fis376vd3-1a43mje-yvetfexg1";
        var url = "ezopen://Admin12345@open.ys7.com/D11939279/1.hd.live";
        var deviceSerial = "D11939279";
        var poster = "https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1587535660229&di=5c49faa5ff16ffcb8e6bcd6d778805d4&imgtype=0&src=http%3A%2F%2Fpic1.win4000.com%2Fwallpaper%2F6%2F57b3c86498dff.jpg";

        function handleError(e){
          console.log('捕获到错误',e)
        }

        function handleSuccess(){
          console.log("播放成功回调函数，此处可执行播放成功后续动作");
        }

        var decoder;
        $("#init").click(function () {
          decoder = new EZUIKit.EZUIPlayer({
            id: 'playerWin',
            autoplay: false,
            url: url,
            accessToken: accessToken,
            decoderPath: '../',
            width: 1200,
            height: 800,
            splitBasis: 2,
          });
        })

        $("#start").click(function () {
            function handleError(e){
              console.log('handleError',e)
            }
            function handleSuccess(){
              console.log('handleSuccess')
            }
            decoder.play({
              handleError: handleError,
            });
        })

        $("#stop").click(function () {
            /*停止播放方法1*/
            // decoder.stop();
            /*停止播放方法2 - promise模式*/
            var stopPromise = decoder.stop();
            stopPromise.then(function(){
              console.log("关闭成功，用户执行关闭成功后的操作");
            })
        })

        $(".ctrl").mousedown(function(){
            var data = {
                "accessToken":accessToken,
                "deviceSerial":deviceSerial,
                "channelNo":1,
                "direction":$(this).attr("value"),
                "speed":1
            };
            $.ajax({
                url: "ctrl/start",
                type: "POST",
                data: data,
                dataType: "json",
                contentType: "application/json",
                success: function(result){
                    console.log("ajax请求结果：");
                    console.log(result);
                    if(result.code == 0){
                        console.log(action + "转操作开始！");
                    }
                }
            });
        })

        $(".ctrl").mouseup(stop)

        function stop(){
            var data = {
                "accessToken":accessToken,
                "deviceSerial":deviceSerial,
                "channelNo":1,
                "direction":$(this).attr("value")
            };
            var action = $(this).attr("hint");
            $.ajax({
                url: "ctrl/stop",
                type: "POST",
                data: data,
                dataType: "json",
                contentType: "application/json",
                success: function(result){
                    if(result.code == 0){
                        console.log(action + "转操作停止成功！");
                    }
                }
            });
        }


    </script>
</body>
</html>